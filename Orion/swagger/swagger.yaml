swagger: '2.0'
info:
  description: This is a documentation for Orion context broker API
  version: 1.0.0
  title: Fiware ORION Api
basePath: /
tags:
  - name: Admin
    description: Administration fonctions
  - name: NGSIv2
    description: NGSIv2 feartures
    externalDocs:
      description: API v2 NGSI
      url: http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv2/index.html
  - name: NGSI10
    description: NGSI10 fearture
    externalDocs:
      description: API v1 NGSI 10
      url: http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#context-availability-management-using-ngsi10
  - name: NGSI9
    description: NGSI9 fearture
    externalDocs:
      description: API v1 NGSI 9
      url: http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#context-availability-management-using-ngsi9
schemes:
  - http
paths:
#############################################################################
#
#  Admin
#
  /version:
    get:
      tags:
        - Admin
      summary: Get Version
      description: Return the version of teh Orion instance
      operationId: getVersion
      produces:
        - application/json
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/Version'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
#############################################################################
#
#  V2
#
  /v2/entities:
    get:
      tags:
        - NGSIv2
      summary: Get all entities
      description: Get all entities and filtering result
      operationId: getEntitiesV2
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv2/index.html#getting-all-entities-and-filtering"
      produces:
        - application/json
      parameters:
        - in: query
          name: type
          type: string
          description: Return all entities of the given type
          required: false
        - in: query
          name: idPattern
          type: string
          description: Filter the result with the given regex on id
          required: false
        - in: query
          name: q
          type: string
          description: Filter the result with the given query
          required: false
      responses:
        200:
          description: The list of entities
          schema:
            $ref: '#/definitions/EntitiesV2'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
    post:
      tags:
        - NGSIv2
      summary: Create an entity
      description: Create an entity
      operationId: createEntityV2
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv2/index.html#entity-creation"
      consumes:
        - application/json
      produces:
        - application/json
        - application/octet-stream 
      parameters:
        - in: body
          name: body
          description: The entity to create
          required: true
          schema:
            $ref: '#/definitions/EntityAttributesV2'
      responses:
        201:
          description: Entity successfully created
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v2/entities/{entityid}:
    get:
      tags:
        - NGSIv2
      summary: Query an entity
      description: Query an entity
      operationId: getEntityV2
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv2/index.html#query-entity"
      produces:
        - application/json
      parameters:
        - in: path
          name: entityid
          type: string
          description: The entity Id to query
          required: true
        - in: query
          name: type
          type: string
          description: Return the entity of the given type
          required: false
      responses:
        200:
          description: The entity
          schema:
            $ref: '#/definitions/EntityAttributesV2'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v2/entities/{entityid}?options=keyValues:
    get:
      tags:
        - NGSIv2
      summary: Query an entity with compact result
      description: Query an entity with compact result
      operationId: getEntityKeyValueV2
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv2/index.html#query-entity"
      produces:
        - application/json
      parameters:
        - in: path
          name: entityid
          type: string
          description: The entity Id to query
          required: true
        - in: query
          name: type
          type: string
          description: Return the entity of the given type
          required: false
      responses:
        200:
          description: The searched entity
          schema:
            $ref: '#/definitions/EntityCompactV2'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v2/entities/{entityid}?options=values:
    get:
      tags:
        - NGSIv2
      summary: Query an entity attributes values
      description: Query an entity attributes values
      operationId: getEntityAttributeV2
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv2/index.html#query-entity"
      produces:
        - application/json
      parameters:
        - in: path
          name: entityid
          type: string
          description: The entity Id to query
          required: true
        - in: query
          name: type
          type: string
          description: Return the entity of the given type
          required: false
        - in: query
          name: attrs
          type: string
          description: Attributes list, commat separate, no space
          required: true
      responses:
        200:
          description: The result value
          schema:
            $ref: '#/definitions/ValuesArray'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v2/entities/{entityid}/attrs:
    patch:
      tags:
        - NGSIv2
      summary: Update the existing attributes of an entity
      description: Update the existing attributes of an entity
      operationId: updateEntityAttributeValuesV2
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv2/index.html#update-entity"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: entityid
          type: string
          description: The entity Id to query
          required: true
        - in: body
          name: attribute
          schema:
            $ref: '#/definitions/AttributeListV2'
          description: The attributes to update
          required: true
      responses:
        204:
          description: Success
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
    put:
      tags:
        - NGSIv2
      summary: Update the list of attributes of an entity (Remove existing ones)
      description: Update the list of attributes of an entity (Remove existing ones)
      operationId: updateEntityDefinitionV2
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv2/index.html#update-entity"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: entityid
          type: string
          description: The entity Id to query
          required: true
        - in: body
          name: attribute
          schema:
            $ref: '#/definitions/AttributeListV2'
          description: The attributes to update
          required: true
      responses:
        204:
          description: Success
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v2/entities/{entityid}/attrs/{attribute}:
    get:
      tags:
        - NGSIv2
      summary: Query an entity attribute
      description: Query an entity attribute
      operationId: getEntityAttributeV2
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv2/index.html#query-entity"
      produces:
        - application/json
      parameters:
        - in: path
          name: entityid
          type: string
          description: The entity Id to query
          required: true
        - in: path
          name: attribute
          type: string
          description: The attribute name to query
          required: true
      responses:
        200:
          description: The searched attribute
          schema:
            $ref: '#/definitions/AttributeV2'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v2/entities/{entityid}/attrs/{attribute}/value:
    get:
      tags:
        - NGSIv2
      summary: Query an entity attribute
      description: Query an entity attribute
      operationId: getEntityAttributeValueV2
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv2/index.html#query-entity"
      produces:
        - text/plain
      parameters:
        - in: path
          name: entityid
          type: string
          description: The entity Id to query
          required: true
        - in: path
          name: attribute
          type: string
          description: The attribute name to query
          required: true
      responses:
        200:
          description: The value of the given attribute
          schema:
            $ref: '#/definitions/Value'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
    put:
      tags:
        - NGSIv2
      summary: Update the value of an attribute
      description: Update the value of an attribute
      operationId: updateEntityAttributeValueV2
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv2/index.html#update-entity"
      consumes:
        - text/plain
      produces:
        - text/plain
      parameters:
        - in: path
          name: entityid
          type: string
          description: The entity Id to query
          required: true
        - in: path
          name: attribute
          type: string
          description: The attribute name to query
          required: true
        - in: body
          name: value
          schema:
            $ref: '#/definitions/Value'
          description: The attribute name to query
          required: true
      responses:
        204:
          description: Success
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
# -------------------------------------------------------------------------------
# Subscriptions
  /v2/subscriptions:
    post:
      tags:
        - NGSIv2
      summary: Create a subscription
      description: Create a subscription
      operationId: createSubscriptionV2
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv2/index.html#subscriptions"
      consumes:
        - application/json
      produces:
        - application/json
        - application/octet-stream 
      parameters:
        - in: body
          name: body
          description: The subscription to create
          required: true
          schema:
            $ref: '#/definitions/SubscriptionV2'
      responses:
        201:
          description: Subscription successfully created. See header Location for its ID
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
    get:
      tags:
        - NGSIv2
      summary: Return the list of subscriptions
      description: Return the list of subscriptions
      operationId: listSubscriptionsV2
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv2/index.html#subscriptions"
      consumes:
        - application/json
      produces:
        - application/json
      responses:
        200:
          description: The list of subscription
          schema:
            $ref: '#/definitions/SubscriptionListV2'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v2/subscriptions/{subscriptionId}:
    get:
      tags:
        - NGSIv2
      summary: Return the subscription detail
      description: Return the subscription detail
      operationId: getSubscriptionV2
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv2/index.html#subscriptions"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: subscriptionId
          description: The Id of the subscription searched
          required: true
          type: string
      responses:
        200:
          description: The subscription
          schema:
            $ref: '#/definitions/SubscriptionV2'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
    patch:
      tags:
        - NGSIv2
      summary: Update the subscription
      description: Update the subscription
      operationId: updateSubscriptionV2
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv2/index.html#subscriptions"
      consumes:
        - application/json
      produces:
        - application/json
        - application/octet-stream 
      parameters:
        - in: path
          name: subscriptionId
          description: The Id of the subscription searched
          required: true
          type: string
        - in: body
          name: body
          description: The subscription to update
          required: true
          schema:
            $ref: '#/definitions/SubscriptionV2'
      responses:
        204:
          description: Subscription updated
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
    delete:
      tags:
        - NGSIv2
      summary: Delete the subscription
      description: Delete the subscription
      operationId: deleteSubscriptionV2
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv2/index.html#subscriptions"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: subscriptionId
          description: The Id of the subscription searched
          required: true
          type: string
      responses:
        204:
          description: Subscription deleted
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
# -------------------------------------------------------------------------------
# Types management

  /v2/types:
    get:
      tags:
        - NGSIv2
      summary: Return the list of known types
      description: Return the list of known types
      operationId: listTypes
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv2/index.html#browsing-all-types-and-detailed-information-on-a-type"
      consumes:
        - application/json
      produces:
        - application/json
      responses:
        200:
          description: The list of types
          schema:
            $ref: '#/definitions/TypesV2'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'

  /v2/types?options=values:
    get:
      tags:
        - NGSIv2
      summary: Return the list of known types names
      description: Return the list of known types names
      operationId: listTypesNames
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv2/index.html#browsing-all-types-and-detailed-information-on-a-type"
      consumes:
        - application/json
      produces:
        - application/json
      responses:
        200:
          description: The list of types
          schema:
            type: array
            items:
              type: string
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v2/types/{type}:
    get:
      tags:
        - NGSIv2
      summary: Return the detail of a type
      description: Return the detail of a type
      operationId: gettype
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv2/index.html#browsing-all-types-and-detailed-information-on-a-type"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: type
          description: The name of the type
          required: true
          type: string
      responses:
        200:
          description: The detail of the type
          schema:
            $ref: '#/definitions/TypeV2'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'

# -------------------------------------------------------------------------------
# Batch operations

  /v2/op/update:
    post:
      tags:
        - NGSIv2
      summary: Excecute a batch operation (Append or Update)
      description: Excecute a batch operation (Append or Update)
      operationId: batchUpdate
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv2/index.html#batch-operations"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: action
          description: The action to execute
          required: true
          schema:
            $ref: '#/definitions/ActionV2'
      responses:
        204:
          description: Success
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'

###############################################################################
#
# API v1 NGSI 10
#
  /v1/updateContext:
    post:
      tags:
        - NGSI10
      summary: Create or Update entities
      description: Create or Update Entities.
      operationId: updateEntities
      deprecated: true
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#entity-creation"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          description: The entities to create or update
          required: true
          schema:
            $ref: '#/definitions/UpdateActions'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/RegisterResponse'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'

  /v1/queryContext:
    post:
      tags:
        - NGSI10
      summary: List existing entities
      description: List existing Entities.
      operationId: queryEntities
      deprecated: true
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#query-context-operation"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          description: The description of the requested entities
          required: true
          schema:
            $ref: '#/definitions/QueryContext'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/ContextResponses'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v1/subscribeContext:
    post:
      tags:
        - NGSI10
      summary: Subscribe entity change
      description: Subscribe entity change
      operationId: subscribeContext
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#context-subscriptions"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          description: The description of the subscription
          required: true
          schema:
            $ref: '#/definitions/SubscribeContext'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/SubscribeResponse'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v1/updateContextSubscription:
    post:
      tags:
        - NGSI10
      summary: Update a subscription
      description: Update a subscription
      operationId: updateSubscribeContext
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#context-subscriptions"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          description: The description of the subscription
          required: true
          schema:
            $ref: '#/definitions/UpdateSubscribeContext'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/SubscribeResponse'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v1/unsubscribeContext:
    post:
      tags:
        - NGSI10
      summary: Unsubscribe entity change
      description: Unubscribe entity change
      operationId: unsubscribeContext
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#context-subscriptions"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          description: The subscriptionId to delete
          required: true
          schema:
            $ref: '#/definitions/UnsubscribeContext'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/UnsubscribeResponse'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v1/contextEntities:
    post:
      tags:
        - NGSI10
      summary: Create an entity
      description: Create an entity 
      operationId: createEntity
      deprecated: true
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#convenience-entity-creation"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          description: The entity to create
          required: true
          schema:
            $ref: '#/definitions/EntityAttributes'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/EntityCreationContextResponses'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
    get:
      tags:
        - NGSI10
      summary: Return all entities
      description: Return all entities
      operationId: getEntities
      deprecated: true
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#getting-all-entities"
      produces:
        - application/json
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/ContextResponses'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v1/contextEntities/{entity}:
    post:
      tags:
        - NGSI10
      summary: Create an entity
      description: Create an entity (Entity type will be 'Thing')
      operationId: createEntityThing
      deprecated: true
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#convenience-entity-creation"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: entity
          description: The entity name to create
          required: true
          type: string
        - in: body
          name: body
          description: The entity to create
          required: true
          schema:
            $ref: '#/definitions/ContextAttributes'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/EntityCreationContextResponses'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
    get:
      tags:
        - NGSI10
      summary: Get an entity
      description: Get an entity
      operationId: getEntity
      deprecated: true
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#convenience-query-context"
      produces:
        - application/json
      parameters:
        - in: path
          name: entity
          description: The entity name to create
          required: true
          type: string
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/ContextResponse'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'

  /v1/contextEntities/{entity}/attributes/{attribute}:
    post:
      tags:
        - NGSI10
      summary: Create an attribute and if it doesn't exists the entity 
      description: Create an attribute and if it doesn't exists the entity (Attribute type will be 'Text')
      operationId: createAttribute
      deprecated: true
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#convenience-entity-creation"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: entity
          description: The entity name to create
          required: true
          type: string
        - in: path
          name: attribute
          description: The attribute name to create
          required: true
          type: string
        - in: body
          name: body
          description: The attribute value
          required: true
          schema:
            $ref: '#/definitions/AttributeValue'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/ErrorCode'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
    put:
      tags:
        - NGSI10
      summary: Update an attribute value
      description: Update an attribute value
      operationId: updateAttribute
      deprecated: true
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#convenience-update-context"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: entity
          description: The entity name
          required: true
          type: string
        - in: path
          name: attribute
          description: The attribute name to update
          required: true
          type: string
        - in: body
          name: body
          description: The attribute value
          required: true
          schema:
            $ref: '#/definitions/AttributeValue'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/ErrorCode'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
    get:
      tags:
        - NGSI10
      summary: Get an attribute value
      description: Get an attribute value
      operationId: getAttributeValue
      deprecated: true
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#convenience-query-context"
      produces:
        - application/json
      parameters:
        - in: path
          name: entity
          description: The entity name to create
          required: true
          type: string
        - in: path
          name: attribute
          description: The attribute name to create
          required: true
          type: string
      responses:
        '200':
          description: The attribute value
          schema:
            $ref: '#/definitions/ContextAttributesResponse'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v1/contextEntities/{entity}/attributes:
    put:
      tags:
        - NGSI10
      summary: Update the attributes value of an entity
      description: Update the attributes value of an entity (the values are empty in the response)
      operationId: updateAttributeValue
      deprecated: true
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#convenience-update-context"
      produces:
        - application/json
      parameters:
        - in: path
          name: entity
          description: The entity name to create
          required: true
          type: string
        - in: body
          name: attributes
          required: true
          description: new attributes value
          schema:
            $ref: '#/definitions/ContextAttributes'
      responses:
        '200':
          description: The attribute value
          schema:
            $ref: '#/definitions/ContextAttributesResponse'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v1/contextEntityTypes/{type}:
    get:
      tags:
        - NGSI10
      summary: Return all the entity of a given type
      description: Return all the entity of a given type
      operationId: getEntitiesType
      deprecated: true
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#convenience-query-context"
      produces:
        - application/json
      parameters:
        - in: path
          name: type
          description: The type to query
          required: true
          type: string
      responses:
        '200':
          description: The entities list
          schema:
            $ref: '#/definitions/ContextResponses'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v1/contextEntityTypes/{type}/attributes/{attribute}:
    get:
      tags:
        - NGSI10
      summary: Return all the entities of a given type. only the requested attribute is return
      description: Return all the entities of a given type only the requested attribute is return
      operationId: getEntitiesType
      deprecated: true
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#convenience-query-context"
      produces:
        - application/json
      parameters:
        - in: path
          name: type
          description: The type to query
          required: true
          type: string
        - in: path
          name: attribute
          description: the attribute to return
          required: true
          type: string
      responses:
        '200':
          description: The entities list
          schema:
            $ref: '#/definitions/ContextResponses'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v1/contextTypes:
    get:
      tags:
        - NGSI10
      summary: Return the list of known types
      description: Return the list of known types
      operationId: getTypes
      deprecated: true
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#browsing-all-types-and-detailed-information-on-a-type"
      produces:
        - application/json
      responses:
        '200':
          description: The types list
          schema:
            $ref: '#/definitions/TypesResponse'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v1/contextTypes/{type}:
    get:
      tags:
        - NGSI10
      summary: Return the description of the given type
      description: Return the description of the given type
      operationId: getType
      deprecated: true
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#browsing-all-types-and-detailed-information-on-a-type"
      produces:
        - application/json
      parameters:
        - in: path
          name: type
          description: The type to query
          required: true
          type: string
      responses:
        '200':
          description: The type
          schema:
            $ref: '#/definitions/TypeResponse'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v1/contextSubscriptions:
    post:
      tags:
        - NGSI10
      summary: Subscribe entity change
      description: Subscribe entity change
      operationId: subscribeContextConvenient
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#convenience-operations-for-context-subscriptions"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          description: The description of the subscription
          required: true
          schema:
            $ref: '#/definitions/SubscribeContext'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/SubscribeResponse'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v1/contextSubscriptions/{subscriptionId}:
    put:
      tags:
        - NGSI10
      summary: Update a subscription
      description: Update a subscription (subscriptionId must match body and path)
      operationId: updateSubscribeContextConvenient
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#convenience-operations-for-context-subscriptions"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: subscriptionId
          required: true
          description: The Id of the subscription
          type: string
        - in: body
          name: body
          description: The description of the subscription
          required: true
          schema:
            $ref: '#/definitions/UpdateSubscribeContext'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/SubscribeResponse'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
    delete:
      tags:
        - NGSI10
      summary: Unsubscribe entity change
      description: Unubscribe entity change
      operationId: unsubscribeContextConvenient
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#convenience-operations-for-context-subscriptions"
      produces:
        - application/json
      parameters:
        - in: path
          name: subscriptionId
          required: true
          description: The Id of the subscription
          type: string
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/UnsubscribeResponse'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'

###############################################################################
#
# API v1 NGSI 9
#
  /v1/registry/registerContext:
    post:
      tags:
        - NGSI9
      summary: Register entities
      description: Register Entities
      operationId: registerContext
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#register-context-operation"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          description: The context registration elements
          required: true
          schema:
            $ref: '#/definitions/ContextRegistrations'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/RegisterResponse'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v1/registry/contextEntities/{entityid}:
    get:
      tags:
        - NGSI9
      summary: Discover registration for a given entity
      description: Discover registration
      operationId: discoverEntityRegistration
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#convenience-discover-context-availability"
      produces:
        - application/json
      parameters:
        - in: path
          name: entityid
          required: true
          description: The entity to register
          type: string
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/ContextRegistrationResponses'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v1/registry/contextEntities/{entityid}/attributes/{attribute}:
    get:
      tags:
        - NGSI9
      summary: Discover registration for a given entity and attribute
      description: Discover registration for a given entity and attribute
      operationId: discoverEntityAttributeRegistration
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#convenience-discover-context-availability"
      produces:
        - application/json
      parameters:
        - in: path
          name: entityid
          required: true
          description: The entity to register
          type: string
        - in: path
          name: attribute
          required: true
          description: The attribute of the entity to register
          type: string
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/ContextRegistrationResponses'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
    post:
      tags:
        - NGSI9
      summary: Register an entitie with a given attribute
      description: Register Entities
      operationId: entityAttributeRegisterContext
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#convenience-register-context"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: entityid
          required: true
          description: The entity to register
          type: string
        - in: path
          name: attribute
          required: true
          description: The attribute of the entity to register
          type: string
        - in: body
          name: body
          description: The context registration elements
          required: true
          schema:
            $ref: '#/definitions/EntityContextRegistration'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/RegisterResponse'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v1/registry/contextEntitiesTypes/{typeid}:
    post:
      tags:
        - NGSI9
      summary: Register a type 
      description: Register a Type 
      operationId: typeRegisterContext
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#only-type-entity-registrations-using-convenience-operations"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: typeid
          required: true
          description: The type to register
          type: string
        - in: body
          name: body
          description: The context registration elements
          required: true
          schema:
            $ref: '#/definitions/EntityContextRegistration'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/RegisterResponse'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v1/registry/contextEntitiesTypes/{typeid}/attributes/{attribute}:
    post:
      tags:
        - NGSI9
      summary: Register a type with a given attribute
      description: Register a Type and its given attribute
      operationId: typeAttributeRegisterContext
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#only-type-entity-registrations-using-convenience-operations"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: typeid
          required: true
          description: The type to register
          type: string
        - in: path
          name: attribute
          required: true
          description: The attribute of the type to register
          type: string
        - in: body
          name: body
          description: The context registration elements
          required: true
          schema:
            $ref: '#/definitions/EntityContextRegistration'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/RegisterResponse'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v1/registry/discoverContextAvailability:
    post:
      tags:
        - NGSI9
      summary: Discover Context Availability
      description: Discover Context Availability
      operationId: dicoverContextAvailability
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#discover-context-availability-operation"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          description: The context registration elements
          required: true
          schema:
            $ref: '#/definitions/ContextRegistration'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/ContextRegistrationResponses'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v1/registry/subscribeContextAvailability:
    post:
      tags:
        - NGSI9
      summary: Subscribe Context Availability
      description: Subscribe Context Availability
      operationId: subscribeContextAvailability
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#context-availability-subscriptions"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          description: The context registration elements
          required: true
          schema:
            $ref: '#/definitions/SubscribeRegistration'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/RegisterResponse'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v1/registry/contextAvailabilitySubscriptions:
    post:
      tags:
        - NGSI9
      summary: Subscribe Context Availability
      description: Subscribe Context Availability
      operationId: createContextAvailabilitySubscriptions
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#convenience-operations-for-context-availability-subscriptions"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          description: The context registration elements
          required: true
          schema:
            $ref: '#/definitions/SubscribeRegistration'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/RegisterResponse'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v1/registry/updateContextAvailabilitySubscription:
    post:
      tags:
        - NGSI9
      summary: Update Context Availability Subscription
      description: Update Context Availability Subscription
      operationId: updateContextAvailabilitySubscription
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#context-availability-subscriptions"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          description: The context registration elements
          required: true
          schema:
            $ref: '#/definitions/UpdateSubscribeRegistration'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/RegisterResponse'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v1/registry/contextAvailabilitySubscriptions/{subscriptionID}:
    put:
      tags:
        - NGSI9
      summary: Update Context Availability Subscription
      description: Update Context Availability Subscription
      operationId: updateConvenientContextAvailabilitySubscription
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#convenience-operations-for-context-availability-subscriptions"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: path
          name: subscriptionID
          required: true
          description: The subscription ID to update
          type: string
        - in: body
          name: body
          description: The context registration elements
          required: true
          schema:
            $ref: '#/definitions/UpdateSubscribeRegistration'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/RegisterResponse'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
    delete:
      tags:
        - NGSI9
      summary: Cancel a Subscription
      description: Cancel a Subscription
      operationId: deleteContextAvailability
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#convenience-operations-for-context-availability-subscriptions"
      produces:
        - application/json
      parameters:
        - in: path
          name: subscriptionID
          required: true
          description: The subscription ID to update
          type: string
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/CancelSubscriptionResponse'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
  /v1/registry/unsubscribeContextAvailability:
    post:
      tags:
        - NGSI9
      summary: Cancel a Subscription
      description: Cancel a Subscription
      operationId: unsubscribeContextAvailability
      externalDocs: 
        url: "http://fiware-orion.readthedocs.io/en/master/user/walkthrough_apiv1/index.html#context-availability-subscriptions"
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          description: The subscription to cancel
          required: true
          schema:
            $ref: '#/definitions/Subscription'
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/CancelSubscriptionResponse'
        default:
          description: Error
          schema:
            $ref: '#/definitions/ErrorResponse'
definitions:
############################################################################
#
# Global Types
#
  StringArray:
    type: array
    items:
      type: string
  Duration:
    type: string
    description: https://en.wikipedia.org/wiki/ISO_8601#Durations
  Value:
    type: [string, integer, number]
  AttributeValue:
    required:
      - value
    properties:
      value:
        $ref: '#/definitions/Value'
  ValuesArray:
    type: array
    items:
      $ref: '#/definitions/Value'



############################################################################
#
# Type for Admin
#
  Version:
    required:
      - orion
    properties:
      orion:
        $ref: '#/definitions/OrionVersion'
  OrionVersion:
    required:
      - version
    properties:
      version:
        type: string
      uptime:
        type: string
      git_hash:
        type: string
      compile_time:
        type: string
      compiled_by:
        type: string
      compiled_in:
        type: string


############################################################################
#
# Type for APIv2
#
  EntitiesV2:
    type: array
    items:
      $ref: '#/definitions/EntityAttributesV2'
  EntityCompactV2:
    allOf:
      - $ref: '#/definitions/EntityV2'
      - additionalProperties:
          $ref: '#/definitions/Value'
  EntityV2:
    required:
      - type
      - id
    properties:
      type:
        type: string
      id:
        type: string
  EntityAttributesV2:
    allOf:
      - $ref: '#/definitions/EntityV2'
      - $ref: '#/definitions/AttributeListV2'
  AttributeListV2:
    additionalProperties:
      $ref: '#/definitions/AttributeV2'
  AttributeV2:
    required:
      - value
      - type
    allOf:
      - $ref: '#/definitions/AttributeValue'
      - properties:
          type:
            type: string
          metadata:
            type: object
  ErrorResponse:
    required:
      - error
      - description
    properties:
      error:
        type: string
      description:
        type: string
  SubscriptionListV2:
    type: array
    items:
      $ref: '#/definitions/SubscriptionV2'
  SubscriptionV2:
    required:
      - subject
      - notification
      - throttling
    properties:
      id:
        type: string
      status:
        enum: ["active", "inactive"]
      description:
        type: string
      subject:
        $ref: '#/definitions/SubscriptionSubjectV2'
      notification:
        $ref: '#/definitions/NotificationV2'
      expires:
        type: string
        format: date-time
      throttling:
        type: integer
  SubscriptionSubjectV2:
    required:
      - entities
      - condition
    properties:
      entities:
        type: array
        items:
          $ref: '#/definitions/EntityV2'
      condition:
        $ref: '#/definitions/SubscriptionConditionV2'
  SubscriptionConditionV2:
    properties:
      attrs:
        type: array
        items:
          type: string
  NotificationV2:
    required:
      - attrs
    properties:
      timeSent:
        type: integer
      lastNotification:
        type: string
        format: date-time
      attrsFormat:
        enum: ["normalized"]
      http:
        $ref: '#/definitions/NotificationHttpV2'
      attrs:
        type: array
        items: 
          type: string
      exceptAttrs:
        type: array
        items: 
          type: string
  NotificationHttpV2:
    required:
      - url
    properties:
      url:
        type: string
  TypesV2:
    type: array
    items:
      $ref: '#/definitions/TypeV2'
  TypeV2:
    required:
      - count
    properties:
      attrs:
        $ref: '#/definitions/AttributesTypeV2'
      count:
        type: integer
      type:
        type: string
  AttributesTypeV2:
    additionalProperties:
      $ref: '#/definitions/AttributeTypeV2'
  AttributeTypeV2:
    required:
      - types
    properties:
      types:
        type: array
        items:
          type: string
  ActionV2:
    required:
      - actionType
      - entities
    properties:
      actionType:
        type: string
        enum: ["APPEND", "UPDATE", "DELETE", "APPEND_STRICT"]
      entities:
        type: array
        items: 
          $ref: '#/definitions/EntityAttributesV2'

############################################################################
#
# Type for APIv1 NGSI 10
#
  QueryContext:
    allOf:
      - $ref: '#/definitions/Entities'
      - properties:
          attrinutes:
            type: array
            items: 
              type: string
  UpdateActions:
    required:
      - contextElements
      - updateAction
    properties:
      contextElements:
        type: array
        items:
          $ref: '#/definitions/Entity'
      updateAction:
        type: string
        enum: [APPEND, UPDATE] 
  ContextResponses:
    required:
      - contextResponses
    properties:
      contextResponses:
        type: array
        items:
          $ref: '#/definitions/ContextResponse'
  ContextResponse:
    allOf:
      - properties:
          contextElement:
            $ref: '#/definitions/EntityAttributes'
      - $ref: '#/definitions/Response'
  SubscribeContext:
    required:
      - entities
      - reference
      - duration
      - throttling
    properties:
      entities:
        type: array
        items:
          $ref: '#/definitions/Entity'
      attributes:
        type: array
        items:
          type: string
      reference:
        type: string
      duration:
        $ref: '#/definitions/Duration'
      throttling:
        $ref: '#/definitions/Duration'
      notifyConditions:
        type: array
        items:
          $ref: '#/definitions/NotifyCondition'
  UpdateSubscribeContext:
    required:
      - subscriptionId
    properties:
      subscriptionId:
        type: string
      entities:
        type: array
        items:
          $ref: '#/definitions/Entity'
      attributes:
        type: array
        items:
          type: string
      reference:
        type: string
      duration:
        $ref: '#/definitions/Duration'
      throttling:
        $ref: '#/definitions/Duration'
      notifyConditions:
        type: array
        items:
          $ref: '#/definitions/NotifyCondition'
  UnsubscribeContext:
    required:
      - subscriptionId
    properties:
      subscriptionId:
        type: string
  NotifyCondition:
    properties:
      type:
        type: string
        enum: [ONCHANGE]
      condValues:
        type: array
        items:
          type: string
  SubscribeResponse:
    properties:
      duration:
        $ref: '#/definitions/Duration'
      subscriptionId:
        type: string
  UnsubscribeResponse:
    allOf:
      - $ref: '#/definitions/Response'
      - properties:
          subscriptionId:
            type: string
  EntityCreationContextResponse:
    allOf:
      - $ref: '#/definitions/ContextAttributes'
      - $ref: '#/definitions/Response'
  EntityCreationContextResponses:
    allOf:
      - $ref: '#/definitions/Entity'
      - properties:
          contextResponses:
            type: array
            items:
              $ref: '#/definitions/EntityCreationContextResponse'
  Type: 
    allOf:
      - $ref: '#/definitions/ContextAttributes'
      - properties:
          name:
            type: string
  TypesResponse:
    allOf:
      - $ref: '#/definitions/Response'
      - properties:
          types:
            type: array
            items:
              $ref: '#/definitions/Type'
  TypeResponse:
    allOf:
      - $ref: '#/definitions/Response'
      - $ref: '#/definitions/Type'

############################################################################
#
# Type for APIv1 NGSI 9
#
  CancelSubscriptionResponse:
    allOf:
      - $ref: '#/definitions/Response'
      - properties:
          subscriptionId:
            type: string
  Subscription:
    required:
      - subscriptionId
    properties:
      subscriptionId:
        type: string
  EntityContextRegistration:
    required:
      - duration
    properties:
      duration:
        $ref: '#/definitions/Duration'
      provindingApplication:
        type: string
  SubscribeRegistration:
    allOf:
      - properties:
          entities:
            type: array
            items:
              $ref: '#/definitions/Entity'
          reference:
            type: string
          duration:
            $ref: '#/definitions/Duration'
          provindingApplication:
            type: string
          subscriptionId:
            type: string
      - $ref: '#/definitions/ContextAttributes'
  UpdateSubscribeRegistration:
    required:
      - subscriptionId
    allOf:
      - properties:
          subscriptionId:
            type: string
      - $ref: '#/definitions/SubscribeRegistration'
  ContextRegistrationResponses:
    properties:
      contextRegistrationResponses:
        type: array
        items:
          $ref: '#/definitions/ContextRegistration'
      errorCode:
        $ref: '#/definitions/ErrorCode'
  ContextRegistrations:
    required:
      - contextRegistrations
      - duration
    properties:
      contextRegistrations:
        type: array
        items:
          $ref: '#/definitions/ContextRegistration'
      duration:
        $ref: '#/definitions/Duration'
  ContextRegistration:
    required:
      - entities
    allOf:
      - properties:
          entities:
            type: array
            items:
              $ref: '#/definitions/Entity'
          provindingApplication:
            type: string
      - $ref: '#/definitions/ContextAttributes'
  Entities: 
    required:
      - entities
    properties:
      entities:
        type: array
        items:
          $ref: '#/definitions/Entity'
  Entity:
    required:
      - type
      - id
    properties:
      type:
        type: string
      isPattern:
        type: boolean
      id:
        type: string
  EntityAttributes:
    allOf:
      - $ref: '#/definitions/Entity'
      - $ref: '#/definitions/ContextAttributes'
  Attribute:
    required:
      - name
    allOf:
      - properties:
          name:
            type: string
          type:
            type: string
          isDomain:
            type: boolean
          value:
            type: [string, integer, number]
      - $ref: '#/definitions/AttributeValue'
  ContextAttributes:
    properties:
      attributes:
        type: array
        items:
          $ref: '#/definitions/Attribute'
  ContextAttributesResponse:
    allOf:
      - $ref: '#/definitions/ContextAttributes'
      - $ref: '#/definitions/Response'
  RegisterResponse:
    properties:
      duration:
        $ref: '#/definitions/Duration'
      registrationId:
        type: string
      errorCode:
        $ref: '#/definitions/ErrorCode'
  Response:
    properties:
      statusCode:
        $ref: '#/definitions/ErrorCode'
  ErrorCode:
    required:
      - code
      - reasonPrase
    properties:
      code:
        type: string
      reasonPrase:
        type: string
externalDocs:
  description: Fiware Orion Context Broker documentation
  url: 'http://fiware-orion.readthedocs.io'
